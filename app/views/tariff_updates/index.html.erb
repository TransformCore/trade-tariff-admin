<h2>Tariff Updates</h2>

<table class='table table-bordered table-striped table-condensed table-tariff-updates'>
  <thead>
    <tr>
      <th class='span2'>Update type</th>
      <th class='span2'>File name</th>
      <th class='span2'>State</th>
      <th class='span2'>Created at</th>
      <th class='span2'>Applied at</th>
      <th class='span2'>File size</th>
    </tr>
  </thead>
  <tbody>
    <% @tariff_updates.each do |tariff_update| %>
      <tr id='<%= dom_id(tariff_update) %>'>
        <td><%= tariff_update.update_type %></td>
        <td><%= tariff_update.filename %></td>
        <td>
          <%= tariff_update.state %>
          <% if tariff_update.exception_class %>
            <div><%= link_to tariff_update.exception_class, "#", data: { toggle: "modal", target: "#exception-modal-#{tariff_update.id}" } %></div>

            <%= content_tag :div, id: "exception-modal-#{tariff_update.id}", class: "modal hide fade" do %>
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                <h3><%= tariff_update.exception_class %></h3>
              </div>
              <div class="modal-body">
                <% if tariff_update.exception_queries %>
                  <div>queries:</div>
                  <pre><%= tariff_update.exception_queries %></pre>
                <% end %>
                <% if tariff_update.exception_backtrace %>
                  <div>backtrace:</div>
                  <pre><%= tariff_update.exception_backtrace %></pre>
                <% end %>
              </div>
            <% end %>
          <% end %>
        </td>
        <td><%= l tariff_update.created_at, format: :tariff %></td>
        <td><%= l(tariff_update.applied_at, format: :tariff) if tariff_update.applied_at %></td>
        <td><%= number_to_human_size(tariff_update.filesize) %></td>
      </tr>
    <% end %>
  </tbody>
</table>
